version: 2

models:

  - name: stg_fivetran_log_active_volume
    columns: 
      - name: active_volume_id
        description: Unique ID of the table's MAR measurement record
        tests:
          - unique
          - not_null
      - name: connector_id
        description:  todo - figure out what to do about this since connector_id actually refers to connector_name....
      - name: destination_id
        description: Foreign key referencing the DESTINATION whose table is being measured
      - name: measured_at
        description: Timestamp of when the entry's MAR measurement was made.
      - name: monthly_active_rows
        description: The number of MAR measured on this date for this table
      - name: schema_name
        description: The name of the connector schema where the measured table lives
      - name: table_name
        description: Name of the table whose volume is being measured


  - name: stg_fivetran_log_connector
    columns:
      - name: connector_id
        description: Unique ID of the connector. Note that a connector loading data into 2 warehouses will have 2 distinct records.
        tests:
          - unique
          - not_null
      - name: connecting_user_id
        description: Foreign key referencing the USER who set up the connection.
      - name: connector_name
        description: Name of the connector
      - name: connector_type
        description: The kind of connector (ie google sheets, webhooks)
      - name: destination_id
        description: Foreign key referencing the DESTINATION warehouse that the connector data is loaded into.
      - name: is_paused
        description: Boolean that's true if the connect
      - name: signed_up_at
        description: Timestamp of when the connection was set up

  - name: stg_fivetran_log_credits_used
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: 
            - destination_id
            - measured_month
    columns:
      - name: destination_id
        description: Foreign key referencing the DESTINATION warehouse that the credits were used on
      - name: measured_month
        description: The month (yyyy-mm) in which the credits were used
      - name: credits_consumed
        description: The number of credits used for the given month - destination

  - name: stg_fivetran_log_destination
    columns:
      - name: destination_id
        description: Unique ID of the destination warehouse
        tests:
          - unique
          - not_null
      - name: account_id
        description: Foreign key referencing the fivetran ACCOUNT associated with the destination
      - name: created_at
        description: Timestamp of when the destination was set up
      - name: destination_name
        description: Name of the destination warehouse
      - name: region
        description: Geographical region of the destination

  - name: stg_fivetran_log_log
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: 
            - log_id
            - created_at
    columns: 
      - name: log_id # TODO: this is actually = connector_id or transformation_id
        description: System-generated unique ID of the log entry
      - name: created_at
        description: Timestamp of when the event was logged
      - name: connector_id
        description: todo - figure this out
      - name: event_type
        description: The umbrella category of the event -- either INFO, SEVERE, WARNING, or TRANSFORMATION
      - name: message_data # todo: unsure what to rename these...
        description: JSON of the event-specific data
      - name: message_event
        description: More specific category related to the nature of the event
      - name: transformation_id
        description: Foreign key referencing the TRANSFORMATION if the event is a transformation
  